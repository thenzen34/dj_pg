build:
  docker:
    web: Dockerfile
    worker: Dockerfile
run:
  web: daphne -b 0.0.0.0 -p $PORT backend.asgi:application
  test:
    command:
      - echo hello
  worker:
    command:
      - python manage.py collectstatic --noinput
      - python manage.py migrate
      - python manage.py runworker channels --settings=backend.settings
      - celery worker -A backend worker -l INFO
    image: web
release:
  image: web
  command:
    - echo 'Starting server after deployment!';
